define(["jquery","core/templates","core/notification","core/pubsub","core/paged_content_events"],function(a,b,c,d,e){var f={ROOT:'[data-region="page-container"]',PAGE_REGION:'[data-region="paged-content-page"]',ACTIVE_PAGE_REGION:'[data-region="paged-content-page"].active'},g={PAGING_CONTENT_ITEM:"core/paged_content_page",LOADING:"core/overlay_loading"},h=300,i=function(a,b){return a.find('[data-page="'+b+'"]')},j=function(d){var e=a.Deferred();return d.attr("aria-busy",!0),b.render(g.LOADING,{visible:!0}).then(function(b){var c=a(b),f=setTimeout(function(){d.css("position","relative"),c.appendTo(d)},h);e.always(function(){clearTimeout(f),c.remove(),d.css("position",""),d.removeAttr("aria-busy")})}).fail(c.exception),e},k=function(d,e,f){var h=a.Deferred();return e.then(function(a,e){e=e||"",b.render(g.PAGING_CONTENT_ITEM,{page:f,content:a}).then(function(a){b.appendNodeContents(d,a,e);var c=i(d,f);h.resolve(c)}).fail(function(a){h.reject(a)}).fail(c.exception)}).fail(function(a){h.reject(a)}).fail(c.exception),h.promise()},l=function(b,g,h,l,m){var n=[],o=[],p=a.Deferred(),q=!0;if(g.forEach(function(a){m>1&&a.pageNumber!=m&&(q=!1);var c=a.pageNumber,d=i(b,c);d.length?n.push(d):o.push(a)}),o.length&&"function"==typeof l){var r=l(o,{allItemsLoaded:function(a){d.publish(h+e.ALL_ITEMS_LOADED,a)}}),s=r.map(function(a,c){return k(b,a,o[c].pageNumber)});a.when.apply(a,s).then(function(){var a=Array.prototype.slice.call(arguments);p.resolve(a)}).fail(function(a){p.reject(a)}).fail(c.exception)}else p.resolve([]);var t=j(b);p.then(function(a){var c=n.concat(a);b.find(f.PAGE_REGION).addClass("hidden"),c.forEach(function(a){q&&a.removeClass("hidden")})}).then(function(){d.publish(h+e.PAGES_SHOWN,g)}).fail(c.exception).always(function(){t.resolve()})},m=function(b,c,f,g){b=a(b),d.subscribe(c+e.SHOW_PAGES,function(a){l(b,a,c,f,g),g=0}),d.subscribe(c+e.SET_ITEMS_PER_PAGE_LIMIT,function(){b.empty()})};return{init:m,rootSelector:f.ROOT}});