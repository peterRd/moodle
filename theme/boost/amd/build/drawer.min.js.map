{"version":3,"sources":["../src/drawer.js"],"names":["backdropPromise","pageContent","document","querySelector","pageWrapper","getBackdrop","Templates","render","then","html","ModalBackdrop","fail","Notification","exception","closeNav","navRegion","toggleButton","local","preference","getAttribute","state","small","body","clientWidth","backdrop","hide","style","overflow","classList","remove","M","util","set_user_preference","showNav","setZIndex","show","add","region","PubSub","publish","toggle","closeButton","addEventListener","subscribe","thisregion","window"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Toggling the visibility of the secondary navigation on mobile.\n *\n * @package    theme_boost\n * @copyright  2021 Bas Brands\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {classUtil} from 'core/utils';\nimport ModalBackdrop from 'core/modal_backdrop';\nimport Templates from 'core/templates';\nimport * as PubSub from 'core/pubsub';\n\nlet backdropPromise = 0;\n\nconst pageContent = document.querySelector('[data-region=\"mainpage\"]');\nconst pageWrapper = document.querySelector('#page-wrapper');\n\nconst getBackdrop = () => {\n    if (!backdropPromise) {\n        backdropPromise = Templates.render('core/modal_backdrop', {})\n            .then(function(html) {\n                return new ModalBackdrop(html);\n            })\n            .fail(Notification.exception);\n    }\n    return backdropPromise;\n};\n\nconst closeNav = (navRegion, toggleButton, local) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    const small = document.body.clientWidth < 768;\n\n    classUtil('remove', navRegion, 'show');\n\n    if (small && local === true) {\n        getBackdrop().then(backdrop => {\n            backdrop.hide();\n            pageWrapper.style.overflow = 'auto';\n        });\n    }\n\n    if (state) {\n        pageContent.classList.remove(state);\n    }\n    if (!small && preference) {\n        M.util.set_user_preference(preference, 'false');\n    }\n};\n\nconst showNav = (navRegion, toggleButton) => {\n    const preference = toggleButton.getAttribute('data-preference');\n    const state = toggleButton.getAttribute('data-state');\n    const small = document.body.clientWidth < 768;\n\n    classUtil('add', navRegion, 'show');\n\n    if (small) {\n        getBackdrop().then(backdrop => {\n            backdrop.setZIndex(1020);\n            backdrop.show();\n            pageWrapper.style.overflow = 'hidden';\n        });\n    }\n\n    if (state) {\n        pageContent.classList.add(state);\n    }\n\n    if (!small && preference) {\n        M.util.set_user_preference(preference, 'true');\n    }\n    const region = navRegion.getAttribute('data-region');\n    if (region) {\n        PubSub.publish('show-drawer', region);\n    }\n};\n\nexport const region = (region, toggle) => {\n    const navRegion = document.querySelector(region);\n    if (!navRegion) {\n        return '';\n    }\n    const toggleButton = document.querySelector(toggle);\n    const closeButton = navRegion.querySelector('[data-action=\"closedrawer\"]');\n\n    toggleButton.addEventListener('click', () => {\n        if (classUtil('has', navRegion, 'show')) {\n            closeNav(navRegion, toggleButton, true);\n        } else {\n            showNav(navRegion, toggleButton);\n        }\n    });\n\n    if (closeButton) {\n        closeButton.addEventListener('click', () => {\n            closeNav(navRegion, toggleButton, true);\n        });\n    }\n\n    PubSub.subscribe('show-drawer', function(region) {\n        const thisregion = navRegion.getAttribute('data-region');\n        if (thisregion !== region) {\n            closeNav(navRegion, toggleButton);\n        }\n    });\n\n    window.addEventListener('resize', function () {\n        closeNav(navRegion, toggleButton, true);\n    });\n};\n"],"file":"drawer.min.js"}